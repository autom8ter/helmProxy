# time is an rfc 3339 timestamp
scalar Time
# Map is a k/v map where the key is a string and the value is any value
scalar Map

type App {
    # name of the application
    name: String!
    # application namespace
    namespace: String!
    # docker image of application
    image: String!
    # args are arguments given to the container/image at startup
    args: [String!]
    # k/v map of environmental variables
    env: Map
    # k/v map of ports to expose ex: http: 80 https: 443
    ports: Map!
    # number of deployment replicas min:1
    replicas: Int!
    # status tracks the state of the application during it's lifecycle
    status: Status!
}


type Task {
    # name of the application
    name: String!
    # application namespace
    namespace: String!
    # docker image of application
    image: String!
    # args are arguments given to the container/image at startup
    args: [String!]
    # k/v map of environmental variables
    env: Map
    schedule: String!
}

type Replica {
    phase: String!
    condition: String!
    reason: String!
}

type Status {
    replicas: [Replica]!
}

type Log {
    message: String!
}

type Namespaces {
    namespaces: [String!]
}

input Namespace {
    namespace: String!
}

input AppConstructor {
    # name of the application
    name: String!
    # application namespace
    namespace: String!
    # docker image of application
    image: String!
    # args are arguments given to the container/image at startup
    args: [String!]
    # k/v map of environmental variables
    env: Map
    # k/v map of ports to expose ex: http: 80 https: 443
    ports: Map!
    # number of deployment replicas min:1
    replicas: Int!
}


input TaskConstructor {
    # name of the application
    name: String!
    # application namespace
    namespace: String!
    # docker image of application
    image: String!
    # args are arguments given to the container/image at startup
    args: [String!]
    # k/v map of environmental variables
    env: Map
    schedule: String!
}

input AppUpdate {
    # name of the application
    name: String!
    # application namespace
    namespace: String!
    # docker image of application
    image: String
    # args are arguments given to the container/image at startup
    args: [String!]
    # k/v map of environmental variables
    env: Map
    # k/v map of ports to expose ex: http: 80 https: 443
    ports: Map
    # number of deployment replicas min:1
    replicas: Int
}

input TaskUpdate {
    # name of the application
    name: String!
    # application namespace
    namespace: String!
    # docker image of application
    image: String
    # args are arguments given to the container/image at startup
    args: [String!]
    # k/v map of environmental variables
    env: Map
    schedule: String
}

input Ref {
    # name of the application
    name: String!
    # application namespace
    namespace: String!
}

type Mutation {
    createApp(input: AppConstructor!): App
    updateApp(input: AppUpdate!): App
    delApp(input: Ref!): String

    createTask(input: TaskConstructor!): Task
    updateTask(input: TaskUpdate!): Task

    delTask(input: Ref!): String
    delAll(input: Namespace!): String
}

type Query {
    getApp(input: Ref!): App
    listApps(input: Namespace!): [App!]

    getTask(input: Ref!): Task
    listTasks(input: Namespace!): [Task!]

    listNamespaces(input: String): Namespaces!
}

type Subscription {
    logs(input: Ref!): String!
}
